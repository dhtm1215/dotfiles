# ==========================================================
# 1. CORE: Vim/VI 모드 활성화 (가장 중요)
#    - 이 설정이 있어야 복사 모드에서 Vim 키(w, e, v, y)가 작동합니다.
# ==========================================================
set-window-option -g mode-keys vi 
set-option -g status-keys vi
# set -g mouse on # (마우스 스크롤을 원하시면 이 줄의 #을 제거)

# ==========================================================
# 2. Appearance & Plugins (기존 설정 유지)
# ==========================================================
# 하단 바 색상
set -g status-bg colour234
set -g status-fg white

# 왼쪽: 세션 이름 + 창 번호
set -g status-left "#[fg=green]#S #[fg=yellow]#I:#W"

# 오른쪽: 날짜, 시각
set -g status-right "#[fg=cyan]%Y-%m-%d #[fg=magenta]%H:%M"

# 플러그인 매니저
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-resurrect'

run '~/.tmux/plugins/tpm/tpm'

# Git 브랜치 표시 함수
set -g status-right-length 100
set -g status-right '#(git -C "#{pane_current_path}" rev-parse --abbrev-ref HEAD 2>/dev/null) | %Y-%m-%d %H:%M'

# ==========================================================
# Copy mode (vi) + clipboard (macOS/Linux 분기)
# ==========================================================
setw -g mode-keys vi

# copy-mode 진입 (prefix + [ 는 tmux 기본)
# 선택 시작: v
bind-key -T copy-mode-vi v send -X begin-selection

# macOS / Linux / Wayland 분기해서 yank 처리
if-shell 'command -v pbcopy >/dev/null 2>&1' \
  'bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"' \
  'if-shell "command -v wl-copy >/dev/null 2>&1" \
     "bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel \"wl-copy\"" \
     "if-shell \"command -v xclip >/dev/null 2>&1\" \
        \"bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel \\\"xclip -in -selection clipboard\\\"\" \
        \"if-shell \\\"command -v xsel >/dev/null 2>&1\\\" \
           \\\"bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel \\\\\\\"xsel --clipboard --input\\\\\\\"\\\" \
           \\\"bind-key -T copy-mode-vi y send -X copy-selection-and-cancel\\\"\" " '

# paste (tmux buffer)
bind-key p paste-buffer
