# ==========================================================
# 1. CORE: Vim/VI 모드 활성화 (가장 중요)
#    - 이 설정이 있어야 복사 모드에서 Vim 키(w, e, v, y)가 작동합니다.
# ==========================================================
set-window-option -g mode-keys vi 
set-option -g status-keys vi
# set -g mouse on # (마우스 스크롤을 원하시면 이 줄의 #을 제거)

# ==========================================================
# 2. Appearance & Plugins
# ==========================================================
# Catppuccin for tmux (Mocha)
# - uses TPM to install
# - defaults to mocha; kept explicit here
set -g @plugin 'catppuccin/tmux#v2.1.3'
set -g @catppuccin_flavor 'mocha'

# 플러그인 매니저
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-resurrect'

# Load catppuccin (only if installed by TPM)
if-shell -b '[ -f "${HOME}/.tmux/plugins/tmux/catppuccin.tmux" ]' 'run "${HOME}/.tmux/plugins/tmux/catppuccin.tmux"' ''

# Git 브랜치 표시 + 상태바 모듈
# Note: catppuccin provides status modules, but we keep your git-branch + date/time.
set -g status-right-length 100
set -g status-left-length 100
set -g status-left ""
set -g status-right '#(git -C "#{pane_current_path}" rev-parse --abbrev-ref HEAD 2>/dev/null) | %Y-%m-%d %H:%M'

# TPM (kept last)
run '~/.tmux/plugins/tpm/tpm'

# ==========================================================
# Copy mode (vi) + clipboard (macOS/Linux 분기)
# ==========================================================
setw -g mode-keys vi

# copy-mode 진입 (prefix + [ 는 tmux 기본)
# 선택 시작: v
bind-key -T copy-mode-vi v send -X begin-selection

# macOS / Linux / Wayland 분기해서 yank 처리
if-shell 'command -v pbcopy >/dev/null 2>&1' \
  'bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"' \
  'if-shell "command -v wl-copy >/dev/null 2>&1" \
     "bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel \"wl-copy\"" \
     "if-shell \"command -v xclip >/dev/null 2>&1\" \
        \"bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel \\\"xclip -in -selection clipboard\\\"\" \
        \"if-shell \\\"command -v xsel >/dev/null 2>&1\\\" \
           \\\"bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel \\\\\\\"xsel --clipboard --input\\\\\\\"\\\" \
           \\\"bind-key -T copy-mode-vi y send -X copy-selection-and-cancel\\\"\" " '

# paste (tmux buffer)
bind-key p paste-buffer
